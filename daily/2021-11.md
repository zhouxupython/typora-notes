【cmd】ip

<img src="https://images2015.cnblogs.com/blog/1089507/201702/1089507-20170205152617089-1009718040.jpg" alt="img" style="zoom: 67%;" />

```shell
    # add the bridge node
    sudo ip link add name ${br_name} type bridge
    sudo ip link set dev ${br_name} up
    sudo ip addr add ${br_ip} dev ${br_name}
    
    # namespace gateway address = linked bridge IP address
    sudo ip netns add ${ns_name}
    sudo ip link add $veth_name0 type veth peer name $veth_name1
    
    # link br - ns
    sudo ip link set dev $veth_name1  master ${br_name}
    sudo ip link set dev $veth_name1 up
    sudo ip link set dev $veth_name0 netns ${ns_name}
    
    # configure ns internal IP address
    sudo ip netns exec ${ns_name} ip link set dev $veth_name0 name eth0
    sudo ip netns exec ${ns_name} ip addr add $ns_ipaddr dev eth0
    sudo ip netns exec ${ns_name} ip link set dev eth0 up    
    
    # configure ns internal route
    sudo ip netns exec ${ns_name} ip route add default via $bridge_ipaddr dev eth0
```

```wiki
https://blog.csdn.net/hbuxiaofei/article/details/107116064

```





状态防火墙

NEW  ESTABLISHED





------

asn@shore-2288H-V5:~/asnc$ ./asncli service firewall   insert    --help
grpc Server: localhost:50051
Network ID: network1
Insert the policy to the firewall

Usage:
  ==asncli service firewall insert== [flags]

Examples:
  ==asncli firewall insert== **all** --action allow --ip 1.1.1.1 --port 22
  asncli firewall insert **ceni.beijing.computer-asn-0** --action allow --ip 1.1.1.1 --port 22

Flags:
      --action string      Set firewall action (ALLOW | DENY) (default "ALLOW")
      --direction string   Set firewall direction (IN | OUT) (default "IN")
      **--file string        Set file path to get the policy**
  -h, --help               help for insert
      --interface string   Set firewall netif (data | control | management) (default "data")
      --ip string          Set firewall ip (default "0.0.0.0")
      --mask int           Set firewall mask (default 32)
      --name string        Set firewall name
      --port int           Set firewall port
      --protocol string    Set firewall protocol (default "tcp")

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")







asn@shore-2288H-V5:~/asnc$ ./asncli service firewall delete --help
grpc Server: localhost:50051
Network ID: network1
Delete the policy to the firewall

Usage:
  asncli service firewall delete [flags]

Examples:
  asncli firewall delete all --action allow --ip 1.1.1.1 --port 22
  asncli firewall delete ceni.beijing.computer-asn-0 --action allow --ip 1.1.1.1 --port 22

Flags:
      --action string      Set firewall action (ALLOW | DENY) (default "ALLOW")
      --direction string   Set firewall direction (IN | OUT) (default "IN")
      **--file string        Set file path to get the policy**
  -h, --help               help for delete
      --interface string   Set firewall netif (data | control | management) (default "data")
      --ip string          Set firewall ip (default "0.0.0.0")
      --mask int           Set firewall mask (default 32)
      --name string        Set firewall name
      --port int           Set firewall port
      --protocol string    Set firewall protocol (default "tcp")

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")





asn@shore-2288H-V5:~/asnc$ ./asncli service firewall refresh --help
grpc Server: localhost:50051
Network ID: network1
Refresh the policy to the firewall

Usage:
  asncli service firewall refresh [flags]

Examples:
  asncli firewall refresh all --action allow --ip 1.1.1.1 --port 22
  asncli firewall refresh ceni.beijing.computer-asn-0 --action allow --ip 1.1.1.1 --port 22

Flags:
      --action string      Set firewall action (ALLOW | DENY) (default "ALLOW")
      --direction string   Set firewall direction (IN | OUT) (default "IN")
      **--file string        Set file path to get the policy**
  -h, --help               help for refresh
      --interface string   Set firewall netif (data | control | management) (default "data")
      --ip string          Set firewall ip (default "0.0.0.0")
      --mask int           Set firewall mask (default 32)
      --name string        Set firewall name
      --port int           Set firewall port
      --protocol string    Set firewall protocol (default "tcp")

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")
asn@shore-2288H-V5:~/asnc$ 
asn@shore-2288H-V5:~/asnc$ 





asn@shore-2288H-V5:~/asnc$ ./asncli service firewall reset --help
grpc Server: localhost:50051
Network ID: network1
Reset the policy to the firewall

Usage:
  asncli service firewall reset [flags]

Examples:
  asncli firewall reset all
  asncli firewall reset ceni.beijing.computer-asn-0

Flags:
  -h, --help   help for reset

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")
asn@shore-2288H-V5:~/asnc$ 







asn@shore-2288H-V5:~/asnc$ ./asncli service firewall start --help
grpc Server: localhost:50051
Network ID: network1
start the firewall

Usage:
  asncli service firewall start [flags]

Examples:
  asncli firewall start all
  asncli firewall start ceni.beijing.computer-asn-0

Flags:
  -h, --help          help for start
  -m, --mode string   Set the firewall mode (legacy | whitelist | blacklist (default "legacy")

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")
asn@shore-2288H-V5:~/asnc$ 





asn@shore-2288H-V5:~/asnc$ ./asncli service firewall stop --help
grpc Server: localhost:50051
Network ID: network1
stop the firewall

Usage:
  asncli service firewall stop [flags]

Examples:
  asncli firewall start all
  asncli firewall start ceni.beijing.computer-asn-0

Flags:
  -h, --help   help for stop

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")
asn@shore-2288H-V5:~/asnc$ 
asn@shore-2288H-V5:~/asnc$ 
asn@shore-2288H-V5:~/asnc$ 



asn@shore-2288H-V5:~/asnc$ ./asncli service firewall show --help
grpc Server: localhost:50051
Network ID: network1
Show the firewall configuration of network/service node

Usage:
  asncli service firewall show [flags]

Examples:
  asncli firewall show all
  asncli firewall show ceni.beijing.computer.asn-0

Flags:
  -h, --help   help for show

Global Flags:
      --grpcServer string   grpcServer: IP:Port (default "localhost:50051")
      --networkId string    Network ID (string) (default "network1")
asn@shore-2288H-V5:~/asnc$ 
asn@shore-2288H-V5:~/asnc$ 
asn@shore-2288H-V5:~/asnc$ 

asn@shore-2288H-V5:~/asnc$ ./asncli service firewall show all
grpc Server: localhost:50051
Network ID: network1
{"enabled":false,"mode":"legacy","allowed":[{"action":"ALLOW","name":"SSH","direction":"IN","netif":"management","ip":"","mask":0,"port":22,"protocol":"tcp","appName":"","priority":4,"covered":false,"uuid":""},{"action":"ALLOW","name":"Default Out","direction":"OUT","netif":"management","ip":"","mask":0,"port":0,"protocol":"","appName":"","priority":4,"covered":false,"uuid":""}],"denied":[]}

```json
{
        "enabled": false, 
        "mode": "legacy", 
        "allowed": [
                {
                        "action": "ALLOW", 
                        "name": "SSH", 
                        "direction": "IN", 
                        "netif": "management", 
                        "ip": "", 
                        "mask": 0, 
                        "port": 22, 
                        "protocol": "tcp", 
                        "appName": "", 
                        "priority": 4, 
                        "covered": false, 
                        "uuid": ""
                }, 
                {
                        "action": "ALLOW", 
                        "name": "Default Out", 
                        "direction": "OUT", 
                        "netif": "management", 
                        "ip": "", 
                        "mask": 0, 
                        "port": 0, 
                        "protocol": "", 
                        "appName": "", 
                        "priority": 4, 
                        "covered": false, 
                        "uuid": ""
                }
        ], 
        "denied": [ ]
}

```

